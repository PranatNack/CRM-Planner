<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô - BIGIT CRM</title>
  <link rel="icon" type="image/png" href="https://crm.bigitcorp.co.th/images/logo-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Header -->
    <header class="header"></header>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <!-- Page Header -->
        <div style="margin-bottom: var(--spacing-xl); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
          <div>
            <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h1>
            <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          </div>
          <button class="btn btn-primary" onclick="openCreateTaskModal()">
            ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
          </button>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
          <input 
            type="text" 
            class="form-control" 
            id="searchTasks" 
            placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô..." 
            oninput="applyFilters()"
          >
          
          <select class="form-control" id="filterProject" onchange="applyFilters()">
            <option value="">‡∏ó‡∏∏‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</option>
          </select>

          <select class="form-control" id="filterPriority" onchange="applyFilters()">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</option>
            <option value="high">‡∏™‡∏π‡∏á</option>
            <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="low">‡∏ï‡πà‡∏≥</option>
          </select>

          <select class="form-control" id="filterAssignee" onchange="applyFilters()">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</option>
          </select>

          <button class="btn btn-secondary" onclick="clearFilters()">
            üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
          </button>
        </div>

        <!-- Kanban Board -->
        <div class="kanban-board" id="kanbanBoard"></div>
      </div>
    </main>
  </div>

  <!-- Task Modal -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="taskModalTitle">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
        <button class="modal-close" onclick="closeModal('taskModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="taskForm">
          <div class="form-group">
            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô *</label>
            <input type="text" class="form-control" id="taskTitle" required>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
            <textarea class="form-control" id="taskDescription" rows="4"></textarea>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
            <div class="form-group">
              <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
              <select class="form-control" id="taskStatus">
                <option value="todo">‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥</option>
                <option value="inprogress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                <option value="done">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
              <select class="form-control" id="taskPriority">
                <option value="low">‡∏ï‡πà‡∏≥</option>
                <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                <option value="high">‡∏™‡∏π‡∏á</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á</label>
            <input type="date" class="form-control" id="taskDueDate">
          </div>

          <div class="form-group">
            <label class="form-label">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</label>
            <select class="form-control" id="taskProject"></select>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
            <div class="form-group">
              <label class="form-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
              <select class="form-control" id="taskAssignee"></select>
            </div>

            <div class="form-group">
              <label class="form-label">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</label>
              <select class="form-control" id="taskManager"></select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('taskModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-primary" onclick="saveTask()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <script src="assets/js/app.js"></script>
  <script src="assets/js/projects.js"></script>
  <script src="assets/js/tasks.js"></script>
  <script>
    // Initialize page
    function initTasksPage() {
      // Load filter dropdowns
      loadFilterDropdowns();
      
      // Check URL params
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = urlParams.get('project');
      
      if (projectId) {
        document.getElementById('filterProject').value = projectId;
      }
      
      // Render kanban board
      const filters = getActiveFilters();
      renderKanbanBoard(filters);
    }

    function loadFilterDropdowns() {
      // Load projects
      const projects = getProjects();
      const projectSelect = document.getElementById('filterProject');
      projects.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = p.name;
        projectSelect.appendChild(option);
      });

      // Load users
      const users = getUsers();
      const assigneeSelect = document.getElementById('filterAssignee');
      users.forEach(u => {
        const option = document.createElement('option');
        option.value = u.id;
        option.textContent = u.name;
        assigneeSelect.appendChild(option);
      });
    }

    function clearFilters() {
      document.getElementById('searchTasks').value = '';
      document.getElementById('filterProject').value = '';
      document.getElementById('filterPriority').value = '';
      document.getElementById('filterAssignee').value = '';
      
      renderKanbanBoard();
    }

    // Initialize
    initTasksPage();
  </script>
</body>
</html>
